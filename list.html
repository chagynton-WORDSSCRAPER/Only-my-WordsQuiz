<!DOCTYPE html>

<html>

<head>
  <base target="_top">
  <style>
    body {
      background-color: #E8E3DC;
      font-family: Noto Sans JP, sans-serif;
    }

    @media (prefers-color-scheme: dark) {
      body {
        background-color: #242322;
        color: #ebebeb;
      }

      a {
        color: #4cff8b
      }

    }

    .mgr-10 {
      margin-left: 5px;
      margin-rihgt: 20px;
      margin
    }

    .container {
      display: grid;
      grid-template-columns: repeat(15, 1fr);
      grid-gap: 4px;

    }

    .form {
      grid-column: 2/14;

    }

    .choice {
      margin: 6px;
    }

    input[type="radio"] {
      display: none;
    }

    .radio-label {
      display: block;
    }

    input[type="radio"]:not(:checked)+.radio-text:before {
      border-color: #FFFFFF;
    }

    input[type="radio"]:checked+.radio-text:before {
      border-color: #4cff8b;
      background-color: #4cff8b;
    }

    .radio-text:before {
      content: "";
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-right: 10px;
      margin-bottom: -4px;
      border-width: 2px;
      border-style: solid;
      border-radius: 50%;
      padding: 2px;
      background-clip: content-box;
    }

    button {
      display: grid;
      grid-column: 3/5;
      width: 120px;
      height: 40px;
      margin-bottom: 40px;
      background-color: #FFFFFF;
      color: #000000;
      text-align: center;

    }
    .tablecolor{
      background-color:#b83e42;
    }
  </style>
</head>

<body>
  <a href="https://docs.google.com/spreadsheets/d/1VdpngPLPJsKT0Z0jugzseTR1mm8wMzzuIoIaafwYLOc/edit#gid=1017338485"
    target="_blank">データソース</a>
  <div class="container">
    <div class="form">

      <form id="answers">
        <? let answerNumber = []; ?>
        <? let problemWordNumber = []; ?>
        <? for(let i = 1; i <11; i++){ ?>
        <? let link = []; ?>

        <? let problem = Math.floor( Math.random() * links.length ); ?>
        <? link.push(links[problem][1]); ?>
        <? problemWordNumber.push(problem) ; ?>


        <? for(let t = 1; t < 4; t++){ ?>


        <? let random = Math.floor( Math.random() * links.length ); ?>
        <? link.push(links[random][1]); ?>

        <? } ?>
        <? let {arr, anNum} = arrayShuffle(link); ?>
        <? let linkrandom = arr; ?>
        <? answerNumber.push(anNum); ?>

        <h3 class="problemtitle">
          <?= links[problem][0] ?>
        </h3>

        <? for(let j = 0; j < 4; j++){ ?>
        <label class="radio-label">
      <input type="radio" name="Q<?= i ?>" value="<?= j ?>"><span class="radio-text"><?= linkrandom[j] ?></span>
      </label>
        <br>
        <? } ?>

        <br>
        <br>
        <? } ?>


      </form>
      <script>
        window.addEventListener('load', function() {

         document.getElementById("hiddentable").style.display ="none";

         })
      </script>

      <table border="1" style="border-collapse: collapse" id="hiddentable">
        <tr>
          <th>単語</th>
          <th>語義</th>
          <th>大区分</th>
          <th>場面</th>
        </tr>
        <? for(let i = 0; i < 10; i++){ ?>
        <? let random = Math.floor( Math.random() * links.length ); ?>
        <? let link = links[problemWordNumber[i]]; ?>
        <? let rowname = "RowMarker"+i;?>
        <tr class = "rowname">
          <td>
            <?= link[0] ?>
          </td>
          <td>
            <?= link[1] ?>
          </td>
          <td>
            <?= link[2] ?>
          </td>
          <td>
            <?= link[3] ?>
          </td>
        </tr>
        
        <? } ?>
      </table>

    </div>

    <button style="margin-top: 32px" onclick="sendAnswers();tableDisplay();" >回答を送信</button>



  </div>

  <?　let sheet = SpreadsheetApp.getActive().getSheetByName("ランダム解答記録"); ?>
  <? sheet.appendRow(answerNumber); ?>


</body>
<script>
  function answersCheckforClient(){
    let answers = document.getElementById("answers");
    //let rowSelected = document.getElementById("RowMarker");
    for(let i=0;i<10;i++){
    let correctChoice = Number(answerNumber[i]);
    let input = Number(answers["Q"+i]);
    //if(correctChoice === input){
      //rowSelected[i].classList.add("rowColor");
    //}
    }
  }
  function sendAnswers(){
    let dataObject = {};
    let answers = document.getElementById("answers");
    let rowSelected = document.getElementById("RowMarker");
    dataObject.value1 = answers;
    dataObject.value2 = rowSelected;
    //google.script.run.answersCheckforRowcolor(dataObject);
    google.script.run.withSuccessHandler(success).AnswersCheck(answers);
    google.script.run.withSuccessHandler(tablecolor).AnswersCheck2(answers);
  }

  function success(n){
 
    if(n<10){
    alert(n + "問正解!いいね正解");
    }else　if(10<=n){
    alert(n+ "問正解！？、、解いてくれてほんとにありがとう！！");
    }else{;
        
        }

         }
  function tableDisplay() {

         document.getElementById("hiddentable").style.display ="block";

         }
  function tablecolor(correctedanswers){
       
       corNum = correctedanswers;
       for(let i = 0; i<=corNum.length; i++){
          var table = document.getElementById("hiddentable");
          table.rows[corNum[i]].classList.add("tablecolor")
       }


  }
  
</script>


</html>